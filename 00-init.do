* ------------------------------------------------------------------
*    
*     This file contains the initialization to run the pipeline
*     for the Lake Baringo Project
*                         
*-------------------------------------------------------------------

clear all
set more off
set maxvar 30000
set seed 10051990 

* Define username
global suser = c(username)

* Emanuele (WB laptop)
else if (inlist("${suser}","wb562201", "WB562201")) {
	*Local directory of your project
	local swdLocal = "G:\My Drive\Dottorato UNIBA"
	*Box directory where the Raw Data folder can be located (for those who have access to it)
	local swdBox = "G:\My Drive\Dottorato UNIBA"
}

* Emanuele (personal laptop)
else if (inlist("${suser}","emanu")) {
	*Local directory of your project
	local swdLocal = "G:\My Drive\Dottorato UNIBA"
	*Box directory where the Raw Data folder can be located (for those who have access to it)
	local swdBox = "G:\My Drive\Dottorato UNIBA"
}

* Anna
else if (inlist("${suser}","wb355053", "wb355053")) {
	*Local directory of your project
	local swdLocal = "C:\Users\wb355053\OneDrive - WBG\50x2030\50x2030 M&T\Uganda Soil & Climate Methods Study\Uganda EDI - WB"
	*Box directory where the Raw Data folder can be located (for those who have access to it)
	local swdBox = "C:\Users\wb355053\OneDrive - WBG\50x2030\50x2030 M&T\Uganda Soil & Climate Methods Study\Uganda EDI - WB"
}

* Any other colleague
else if (inlist("${suser}","machine name of other colleague")) {
	local swdLocal = "/Users/somara/Desktop/K-LSRH"
	//temp
	local swdBox = "/Users/somara/Desktop/K-LSRH"
}

else {
	di as error "Configure work environment in init.do before running the code."
	error 1
}

* Define filepaths
global gsdProject="`swdBox'"
global gsdDataRaw = "`swdBox'/Baringo/Rawdata"
global gsdDo = "`swdLocal'/Baringo/Do"
global gsdTemp = "`swdLocal'/Baringo/Temp"
global gsdOutput = "`swdLocal'/Baringo/Output"

macro list

*If needed, install the directories and packages used in the process 
confirmdir "`swdBox'/Baringo/Rawdata"
scalar define n_rawdata=_rc
confirmdir "`swdLocal'/Baringo/Temp"
scalar define n_temp=_rc
confirmdir "`swdLocal'/Baringo/Output"
scalar define n_output=_rc

scalar define check=n_temp+n_output+n_rawdata
di check
if check==0 {
		display "No action needed"
}
else {
	shell mkdir "${gsdDataRaw}"
	
	shell mkdir "${gsdTemp}"
	
	shell mkdir "${gsdOutput}"
}

*If needed, install the necessary commands and packages 
local commands = "fs matchit freqindex savesome distinct confirmdir cfout readreplace winsor2 svygen mdesc labelmiss _gwtmean estout renvarlab keeporder gtools samplepps copydesc outdetect tabout spmap filelist unique multiline combineplot fieldarea vselect iefieldkit geodist"
foreach c of local commands {
	qui capture which `c' 
	qui if _rc!=0 {
		noisily di "This command requires '`c''. The package will now be downloaded and installed."
		qui ssc install `c'
	}
}
*Ipacheck is only used by users with access to raw data
qui capture which ipacheck
qui if _rc!=0 {
	noisily di "This command requires ipacheck. The package will now be downloaded and installed."
	net install ipacheck, all replace from("https://raw.githubusercontent.com/PovertyAction/high-frequency-checks/master")
}
*Github is required
qui capture which github
qui if _rc!=0 {
	noisily di "This command requires github. The package will now be downloaded and installed."
	net install github, from("https://haghish.github.io/github/")
}
*Weather command is required
qui capture which weather
qui if _rc!=0 {
	noisily di "This command requires weather. The package will now be downloaded and installed."
	cap github install /jdavidm/weather_command
}
